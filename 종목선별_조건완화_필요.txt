KIS 자동매매 봇 - 종목 선별 조건 문제 및 완화 방안
==================================================
최종 업데이트: 2025-12-05 14:45 KST

==================================================
🔴 핵심 문제: "조건 충족 종목 없음"
==================================================

현재 상황:
1. 거래량 API는 정상 작동 (30개 종목 데이터 수신 확인)
2. 하지만 모든 종목이 필터 조건을 통과하지 못함
3. 결과: 매매 가능 종목 0개

==================================================
📊 현재 종목 선별 조건 (너무 엄격함)
==================================================

파일 위치: market_scanner.py:376-407

[Universe Filter - 4가지 조건 중 50% 이상 만족 필요]

1. **Trend Strength (추세 강도)**
   - ADX > 25 (추세 강도 지표)
   - 현재가 > MA60 (60일 이동평균선)
   - 현재가 > MA120 (120일 이동평균선)
   문제: 3가지 조건 모두 만족해야 함

2. **Smart Money (수급)**
   - 외국인 + 기관 5일 누적 순매수 > 0
   문제: 최근 외국인/기관이 매도 우위인 시장

3. **Accumulation (매집)**
   - OBV > OBV_MA20 (거래량 지표)
   문제: 거래량 지표도 부진

4. **Fundamentals (가격 필터)**
   - 현재가 >= 1,000원
   문제: 이미 완화되었으나 여전히 제한적

==================================================
🔥 매수 신호 조건 (추가 허들)
==================================================

파일 위치: market_scanner.py:409-434

매수 신호 중 하나라도 만족 필요:
1. MFI < 20 (자금흐름지표 과매도)
2. 스토캐스틱 골든크로스
3. 볼린저밴드 하단 반등

문제: 현재 시장에서 이런 극단적 신호가 드물음

==================================================
💡 제안하는 조건 완화 방안
==================================================

### 1단계: Universe Filter 완화 (즉시 적용 가능)

AS-IS: 4개 조건 중 50%(2개) 이상 만족
TO-BE: 4개 조건 중 25%(1개) 이상 만족

```python
# market_scanner.py:406
return conditions_met >= (total_conditions * 0.25)  # 50% → 25%
```

### 2단계: 추세 조건 완화

AS-IS: ADX > 25 AND MA60 AND MA120
TO-BE: ADX > 20 OR (MA20 AND MA60)

```python
trend_ok = (indicators['adx'] > 20 or
           (indicators['current_price'] > indicators['ma20'] and
            indicators['current_price'] > indicators['ma60']))
```

### 3단계: Smart Money 조건 개선

AS-IS: 5일 누적 > 0
TO-BE: 1일 순매수 > 0 또는 3일 중 2일 이상 순매수

### 4단계: 매수 신호 완화

추가 신호:
- RSI < 40 (과매도 영역 확대)
- 전일 대비 3% 이상 하락 후 반등
- 거래량 급증 (전일 대비 150% 이상)

==================================================
🎯 단계별 적용 계획
==================================================

1. **즉시 적용** (오늘)
   - Universe Filter 50% → 25% 변경
   - 가격 필터 1,000원 → 500원

2. **테스트 후 적용** (내일)
   - ADX 기준 완화 (25 → 20)
   - MA 조건 단순화

3. **추가 개선** (모니터링 후)
   - Smart Money 로직 개선
   - 새로운 매수 신호 추가

==================================================
📈 예상 효과
==================================================

현재: 0개 종목 선별
1단계 후: 5-10개 종목 예상
2단계 후: 10-15개 종목 예상
3단계 후: 15-20개 종목 예상

==================================================
⚠️ 리스크 관리
==================================================

조건 완화 시 주의사항:
1. 손절 기준 엄격 유지 (-3%)
2. 최대 보유 종목 수 유지 (3개)
3. 일일 모니터링 강화
4. 백테스팅 병행 필요

==================================================
🔧 즉시 수정 가능한 코드
==================================================

파일: market_scanner.py

1. 라인 406:
   AS-IS: return conditions_met >= (total_conditions * 0.5)
   TO-BE: return conditions_met >= (total_conditions * 0.25)

2. 라인 402:
   AS-IS: fundamentals_ok = indicators['current_price'] >= 1000
   TO-BE: fundamentals_ok = indicators['current_price'] >= 500

3. 라인 387:
   AS-IS: trend_ok = (indicators['adx'] > 25 and
   TO-BE: trend_ok = (indicators['adx'] > 20 and

==================================================
📝 Gemini에게 물어볼 질문
==================================================

1. 현재 한국 주식시장 상황에서 ADX 25는 너무 엄격한가?
2. 모의투자 환경에서 외국인/기관 데이터의 신뢰성은?
3. 거래량 급증 종목을 찾는 더 나은 방법은?
4. 단기 스윙 트레이딩에 적합한 기술적 지표 조합은?
5. 변동성이 큰 시장에서의 종목 선별 전략은?

==================================================
✅ 해결된 문제들
==================================================

1. BrokenPipeError - 완전 해결
2. 슬랙 실시간 알림 - 정상 작동
3. 거래량 API 필드명 - mksc_shrn_iscd로 수정
4. 빈 rt_cd 처리 - 정상 처리
5. 토큰 공유 시스템 - 정상 작동

==================================================
🚀 다음 액션
==================================================

1. 이 파일을 Gemini/ChatGPT에 공유
2. 조건 완화 우선순위 결정
3. market_scanner.py 수정
4. 테스트 및 모니터링
5. 점진적 개선

==================================================