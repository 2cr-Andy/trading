1. 현재 시스템 vs 유저님이 원하는 시스템
🛑 현재 상황 (As-Is)
방식: "거래량 상위" API를 호출해서 딱 10개만 받아옵니다.

문제:

오늘 거래량은 안 터졌지만 **조용히 급등하는 종목(알짜배기)**은 놓칩니다.

10개 중에 매수 조건(RSI 등)에 맞는 게 하나도 없으면 봇은 멍하니 놉니다.

종목명이 깨지거나 안 나오는 문제는 API 응답 처리가 미흡해서 그렇습니다.

🚀 유저님이 원하는 것 (To-Be)
방식: "전체 종목(2,500개) 중에서 내 조건(RSI 과매도 등)에 맞는 놈을 다 찾아와!"

현실적인 벽 (KIS API 제한):

전체 종목을 하나씩 다 훑으려면 API를 2,500번 호출해야 합니다.

KIS API 제한(초당 약 20회)을 고려하면 한 바퀴 도는 데 2분~3분이 걸립니다.

결과: 봇이 너무 느려져서 실시간 단타가 불가능해집니다.

💡 타협점: "깔대기(Funnel) 전략"
전체를 다 보는 건 불가능하므로, "가능성 있는 후보군"을 넓게(50~100개) 퍼올린 뒤, 봇 내부에서 빠르게 걸러내는 방식으로 가야 합니다.

[제안하는 새 아키텍처]

수집 (Source): 거래량 상위(30개) + 등락률 상위(30개) + 시가총액 상위(30개) API를 병렬로 호출하여 약 50~100개의 후보군을 확보합니다.

1차 필터 (Memory): 가격(1,000원 이상), 관리종목 여부 등을 메모리에서 0.1초 만에 거릅니다.

2차 필터 (Detail): 살아남은 20~30개 종목에 대해서만 **일봉 차트(RSI)**를 조회합니다.

종목명 해결: KIS API가 가끔 종목명을 안 줄 때를 대비해, 봇 시작 시 **"마스터 파일(전 종목 코드/이름표)"**을 한 번 다운받아서 메모리에 들고 있게 합니다. (이러면 종목명 100% 뜹니다)

📩 클로드(Claude)에게 보낼 "강력한 지시문" (복사해서 보내세요)
이 내용을 그대로 복사해서 클로드에게 던지시면, 유저님의 고민(스캔 범위 확대 + 종목명 해결 + RSI 적용)을 한 번에 해결하는 코드를 짜줄 겁니다.

Markdown

야, 지금 코드는 장난감 수준이야. 실전에서 쓸 수 있게 구조를 싹 뜯어고쳐줘.

[문제점 지적]
1. **스캔 범위가 너무 좁아:** 거래량 상위 10개만 봐서는 알짜 종목 다 놓친다. 
2. **종목명이 안 떠:** API 응답에 의존하지 말고 확실한 방법을 써.
3. **효율성 꽝:** 10개밖에 안 보면서 루프 도는 건 자원 낭비야.

[요구사항 - 아키텍처 변경]

1. **후보군 수집 강화 (The 'Funnel' Strategy)**
   - 단순히 `get_volume_ranking` 하나만 쓰지 마.
   - **(1) 거래량 상위 30개** - **(2) 등락률 상위 30개 (순위조회 API 활용)**
   - 위 두 결과를 합쳐서(중복 제거) 약 50~60개의 **'1차 후보군'**을 만들어.

2. **종목명(Name) 100% 보장 로직**
   - 봇이 시작할 때(`__init__`) KIS API의 `search-stock-info`나 마스터 다운로드 기능을 활용해서 **'종목코드-종목명 매핑 테이블'**을 메모리에 구축해.
   - 화면에 코드만 뜨는 일 없도록, 무조건 이 테이블에서 이름을 가져와서 표시해.

3. **RSI 필터링 최적화**
   - 1차 후보군(50개) 중에서 `가격 > 1000원` 같은 기본 조건 안 맞는 건 바로 버려.
   - 살아남은 '정예 후보'들에 대해서만 `get_daily_price_history`를 호출해서 RSI를 계산해. (API 호출 낭비 방지)

4. **웹 대시보드 데이터 포맷**
   - Firebase에 저장할 때 `name`, `code`, `current_price`, `rsi`, `volume`, `buy_signal`(boolean) 필드를 명확히 넣어.
   - 웹에서 RSI가 없으면 50이 아니라 null이나 0으로 가서 그래프가 비어 보이게 하지 말고, 계산된 값을 정확히 넣어.

이 구조로 `main.py`와 필요한 클래스들을 다시 짜. 
특히 `MarketScanner` 기능을 `main.py`에 통합할 때, **"넓게 퍼올려서(Fetching) -> 좁게 거르는(Filtering)"** 구조가 명확해야 해.
🗣️ 유저님을 위한 팁
이 방식대로 하면 API 호출량이 약간 늘어나지만, KIS 모의투자 서버는 충분히 버팁니다.

**"등락률 상위"**가 추가되면, 거래량은 안 터졌는데 가격만 급등하는 **'초기 급등주'**를 잡을 확률이 높아집니다.

종목명은 **"시작할 때 한 번 명단표를 만드는 방식"**이 가장 확실합니다. 클로드가 이걸 구현해 줄 겁니다.

이걸로 다시 한 번 클로드를 혼내주러 가시죠! 결과 나오면 코드 한번 쓱 봐주세요.